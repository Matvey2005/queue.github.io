import{_ as x,u as re,r as h,o as ie,c as f,a as u,b as r,n as O,t as p,i as ue,d as V,e as $,F as C,f as w,g as M,h as j,j as ce,k,l as le,m as de,p as L,q,w as fe,s as me,v as E,x as he,y as F,z as pe,M as ve,A as D}from"./index-D_SXPbO-.js";const ye="/images/Bell.png",ge={class:"alert-wrapper"},be={class:"span-container"},we={__name:"alert",props:{text:{type:String,required:!0},status:{type:String,default:"success"},duration:{type:Number,default:2e3}},setup(t){re(i=>({v7599f3a0:t.duration+"ms"}));const a=t,n=h(!0);return ie(()=>{setTimeout(()=>{n.value=!1},a.duration)}),(i,d)=>(u(),f("div",ge,[r("div",be,[r("span",{class:O(["alert-container",{success:t.status==="success"},{error:t.status==="error"}])},p(t.text),3)])]))}},Ie=x(we,[["__scopeId","data-v-64ef43b9"]]),xe="/images/Exchange.png",Se={class:"element"},ke={style:{display:"flex",gap:"1rem"}},$e={key:1,class:"loader"},_e={__name:"ElementQueue",props:{item:{type:Object,required:!0}},setup(t,{emit:a}){const n=a,i=h(!1),d=h(!1),b=ue("subgroupNumber"),c=m=>{console.log("1"),!d.value&&(d.value=!0,n("excahge",m),setTimeout(()=>{d.value=!1},600))},y=V();return(m,g)=>(u(),f("div",Se,[r("div",ke,[r("span",null,p(t.item.number),1),r("span",null,p(t.item.name),1)]),t.item.status==="–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ"?(u(),f(C,{key:0},[t.item.hideButton?(u(),f("img",{key:0,class:O(["excahgeImage",{rotating:d.value}]),src:xe,alt:"",onClick:g[0]||(g[0]=I=>c(t.item.uid))},null,2)):$("",!0),i.value?(u(),f("span",$e)):$("",!0)],64)):t.item.status==="–û—Ç–ø–∏—Å–∞—Ç—å—Å—è"?(u(),f("button",{key:1,onClick:g[1]||(g[1]=I=>n("unsubscribe",t.item.queueId)),class:"unsubscribe"},p(t.item.status),1)):t.item.status==="–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"&&!t.item.hideButton&&(w(y).state.numberSubgroup===w(b)||w(b)==-1)?(u(),f("button",{key:2,onClick:g[2]||(g[2]=I=>n("subscribe",t.item.number)),class:"subscribe"},p(t.item.status),1)):$("",!0)]))}},Ne=x(_e,[["__scopeId","data-v-978373ff"]]),qe={class:"list"},Ee={__name:"ListQueue",props:{queueItems:{type:Array,required:!0}},setup(t,{emit:a}){const n=a;function i(c){n("subscribe",c)}function d(c){n("unsubscribe",c)}function b(c){n("excahge",c)}return(c,y)=>(u(),f("div",qe,[(u(!0),f(C,null,M(t.queueItems,m=>(u(),j(Ne,{onSubscribe:i,onUnsubscribe:d,onExcahge:b,key:m.number,item:m},null,8,["item"]))),128))]))}},je=x(Ee,[["__scopeId","data-v-6cd6ff66"]]);typeof process<"u"&&process.platform;var U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Te=new Uint8Array(64),Ce=new Uint8Array(128);for(let t=0;t<U.length;t++){let a=U.charCodeAt(t);Te[t]=a,Ce[a]=t}const B="vite-module-runner:import-meta-resolve/v1/";`${JSON.stringify(B)}${JSON.stringify(B)}`;new Proxy({},{get(t,a){throw Error(`[module runner] Dynamic access of "import.meta.env" is not supported. Please, use "import.meta.env.${String(a)}" instead.`)}});const Ae={class:"element"},Qe={class:"elementFooter"},Le={__name:"ElementNotification",props:{notification:{type:Object,required:!0}},setup(t){const a=t;async function n(){await fetch(`https://localhost:7243/api/exchange/${a.notification.id}`,{method:"PATCH",credentials:"include"})}async function i(){await fetch(`https://localhost:7243/api/exchange/${a.notification.id}`,{method:"DELETE",credentials:"include"})}return(d,b)=>(u(),f("div",Ae,[r("div",null,[ce(" –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+p(t.notification?.userName)+" ("+p(t.notification?.number)+"-–æ–µ –º–µ—Å—Ç–æ) —Ö–æ—á–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å—Å—è —Å –≤–∞–º–∏ –º–µ—Å—Ç–∞–º–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç "+p(t.notification?.subjectName)+" ("+p(t.notification?.date)+") ",1),r("div",Qe,[r("span",null,p(t.notification?.createdAt),1),r("button",{class:"buttonConfirm",onClick:n},"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"),r("button",{class:"buttonCancel",onClick:i},"–û—Ç–º–µ–Ω–∏—Ç—å")])])]))}},Fe=x(Le,[["__scopeId","data-v-c796f847"]]),De={class:"conatiner"},Ue={__name:"ListNotifications",setup(t){async function a(){try{const c=await fetch("https://localhost:7243/api/exchange",{method:"GET",credentials:"include"});if(c.ok){const y=await c.json();return console.log("data: ",y),Array.isArray(y)?y:[]}else throw new Error(`HTTP error! status: ${c.status}`)}catch(c){return console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:",c),[]}}const{data:n=[],isLoadingNotifications:i,isErrorNotifications:d,refetch:b}=k({queryKey:["notifications"],queryFn:a,refetchOnWindowFocus:!1,retry:!1,staleTime:0,refetchInterval:3e3});return(c,y)=>(u(),f("div",De,[(u(!0),f(C,null,M(w(n),m=>(u(),j(Fe,{notification:m,key:m.id},null,8,["notification"]))),128))]))}},Be=x(Ue,[["__scopeId","data-v-9518ec1a"]]),Oe={style:{display:"flex","align-items":"start","padding-top":"1.5rem",position:"relative"}},Ve={class:"countNotifications"},Me={style:{display:"flex","flex-direction":"column",gap:"0.5rem"}},Pe={key:0,style:{display:"flex","justify-content":"center","align-items":"center",flex:"1"}},Ke={key:1,style:{flex:"1","overflow-y":"auto"}},We={class:"blockError"},Re={__name:"Queue",setup(t){const a=h(""),n=h(""),i=h(null),d=h(-1),b=h(!1),c=h(""),y=h(!1),m=h(!1),g=h(!1),I=h(""),v=V();D("isLoading",b),D("subgroupNumber",i),le((e,s,o)=>{v.state.userId==-1?o(!1):o()});const A=de(),P=L({mutationFn:W,onSuccess:()=>{A.invalidateQueries({queryKey:["queue"]})},onError:e=>{console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏:",e)}}),K=L({mutationFn:R,onSuccess:()=>{A.invalidateQueries({queryKey:["queue"]})},onError:e=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:",e)}});async function W(e){const s={userId:v.state.userId,dateId:+n.value,numberUser:+e};try{const o=await fetch("https://localhost:7243/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!o.ok){const l=await o.json();I.value=l.message,g.value=!0}}catch(o){g.value=!0,I.value=o.message}}async function R(e){await fetch(`https://localhost:7243/api/queue/${e}`,{method:"DELETE",credentials:"include"})}const G=async()=>{console.log("üì¶ groupId –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:",v.state.groupId);const e=await fetch(`https://localhost:7243/api/subject/subjects/${v.state.groupId}`,{credentials:"include"});if(!e.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø");return e.json()},H=async()=>{const e=await fetch(`https://localhost:7243/api/subject/schedule/${v.state.groupId}`,{credentials:"include"});if(!e.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø");return await e.json()};async function J(){try{const e=await fetch("https://localhost:7243/api/exchange",{method:"GET",credentials:"include"});if(e.ok){const s=await e.json();return console.log("data: ",s),Array.isArray(s)?s:[]}else throw new Error(`HTTP error! status: ${e.status}`)}catch(e){return console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:",e),[]}}const z=async()=>{const e=new URLSearchParams({groupId:v.state.groupId,subjectId:+a.value,subgroupNumber:+i.value,dateId:+n.value}).toString(),s=await fetch(`https://localhost:7243/api/queue?${e}`,{credentials:"include"});if(!s.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø");return await s.json()},{data:T=[],isLoadingNotifications:Ge,isErrorNotifications:He,refetch:Je}=k({queryKey:["notifications"],queryFn:J,refetchOnWindowFocus:!1,retry:!1,staleTime:0,refetchInterval:3e3}),{data:Y=[],isLoadingGroup:ze,isErrorGroup:Ye}=k({queryKey:["subject"],queryFn:G,refetchOnWindowFocus:!1,retry:!1,staleTime:3e5}),{data:_=[],isLoadingDates:Xe,isErrorDates:Ze}=k({queryKey:["dates",a.value],queryFn:H,enabled:q(()=>a.value!==""),refetchOnWindowFocus:!1,retry:!1,staleTime:3e5}),{data:Q=[],isLoadingQueue:et,isErrorQueue:tt,refetch:st}=k({queryKey:q(()=>["queue",a.value,n.value,i.value]),queryFn:z,enabled:q(()=>a.value!==""&&n.value!==""&&i.value!==null),refetchOnWindowFocus:!1,retry:!1,staleTime:0,refetchInterval:1e3}),X=async()=>{const e=await fetch(`https://localhost:7243/api/users/lengthAllStudentsByGroup/${v.state.groupId}`,{credentials:"include"});try{return e.ok?await e.json():0}catch{return 0}},Z=async()=>{const e=await fetch(`https://localhost:7243/api/users/lengthAllStudentsBySubgroup/${v.state.groupId}/${i.value}`,{credentials:"include"});try{return e.ok?await e.json():0}catch{return 0}};fe(a,()=>{console.log("1 ",n.value),n.value=""}),me(async()=>{console.log("2 ",n.value),a.value&&n.value&&(console.log("dates = ",_),console.log("dates.value = ",_?.value),console.log("–ü—Ä–∏–≤–µ—Ç"),i.value=_?.value?.find(e=>e.subjectId===+a?.value&&e.id===+n?.value).forSubgroup,i.value===-1?d.value=await X():d.value=await Z())});const ee=q(()=>{if(!d.value||d.value<=0)return[];let s=!!Q?.value?.find(l=>l.userId===v.state.userId);console.log("isYou: ",s);const o=new Array(d?.value).fill().map((l,S)=>({number:S+1,name:"",status:"–ó–∞–ø–∏—Å–∞—Ç—å—Å—è",hideButton:s,queueId:null,uid:-1}));for(let l of Q?.value||[])o[l.numberUser-1]={...o[l.numberUser-1],name:l.userId===v.state.userId?"–í—ã":l.userName,status:l.userId===v.state.userId?"–û—Ç–ø–∏—Å–∞—Ç—å—Å—è":"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ",hideButton:s,queueId:l.id,uid:l.userId};return o}),te=e=>{K.mutateAsync(e)},se=async e=>{P.mutateAsync(e)},ae=()=>{const e=new Date,s=String(e.getDate()).padStart(2,"0"),o=String(e.getMonth()+1).padStart(2,"0"),l=e.getFullYear(),S=String(e.getHours()).padStart(2,"0"),N=String(e.getMinutes()).padStart(2,"0");return`${s}.${o}.${l} ${S}:${N}`},ne=async e=>{const s=ae(),o=v.state.userId,l=e,S=n.value;b.value=!0;try{(await fetch("https://localhost:7243/api/exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({CreatedAt:s,FromUserId:o,ToUserId:l,DateId:S})})).ok()&&(c.value="–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–º–µ–Ω –º–µ—Å—Ç–∞–º–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")}catch(N){c.value=N.message}finally{b.value=!1,y.value=!0,setTimeout(()=>y.value=!1,3e3)}},oe=()=>{m.value=!m.value,console.log(m.value)};return(e,s)=>(u(),f("div",{class:"card",onClick:s[3]||(s[3]=o=>m.value=!1)},[r("header",null,[s[4]||(s[4]=r("div",null,[r("h1",null,"–ó–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç"),r("p",null,"–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏ –¥–∞—Ç—É, —á—Ç–æ–±—ã –∑–∞–Ω—è—Ç—å –æ—á–µ—Ä–µ–¥—å")],-1)),r("div",Oe,[r("img",{src:ye,class:"notificationsImage",onClick:he(oe,["stop"]),alt:""}),r("p",Ve,p(w(T).length<9?w(T).length:"9+"),1),m.value?(u(),j(Be,{key:0,notifications:w(T),class:"notifications-list"},null,8,["notifications"])):$("",!0)])]),r("div",Me,[E(F,{list:w(Y)||[],"id-key":"id","value-key":"name",modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=o=>a.value=o),title:"–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç"},null,8,["list","modelValue"]),E(F,{list:w(_)?.filter(o=>o.subjectId===+a.value)||[],"id-key":"id","value-key":"date",modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=o=>n.value=o),title:"–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"},null,8,["list","modelValue"])]),r("p",null,p(i.value?i.value===-1?"–û–±—â–∞—è":`–ü–æ–¥–≥—Ä—É–ø–ø–∞ ${i.value}`:""),1),a.value==""||n.value==""?(u(),f("div",Pe," –ü—É—Å—Ç–æ ")):(u(),f("div",Ke,[E(je,{onSubscribe:se,onUnsubscribe:te,onExcahge:ne,"queue-items":ee.value},null,8,["queue-items"])])),y.value?(u(),j(Ie,{key:2,text:"–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",status:"success"})):$("",!0),E(ve,{open:g.value},{default:pe(()=>[r("div",We,[r("p",null,p(I.value),1),r("button",{class:"close",style:{"align-self":"flex-end"},onClick:s[2]||(s[2]=o=>g.value=!1)}," –û–∫ ")])]),_:1},8,["open"])]))}},ot=x(Re,[["__scopeId","data-v-fd5ae89b"]]);export{ot as default};
