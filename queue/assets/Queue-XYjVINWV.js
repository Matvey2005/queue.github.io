import{_,u as de,r as h,o as fe,c as l,a as i,b as o,n as V,t as g,i as me,d as M,e as x,F as A,f as w,g as K,h as $,j as he,k as S,l as pe,m as ge,p as F,q as E,w as ve,s as ye,v as j,x as B,y as D,z as be,M as we,A as Ie,B as O}from"./index-2I-Mu0Rk.js";const _e="/myqueue/images/Bell.png",xe="/myqueue/images/profile_1.png",ke={class:"alert-wrapper"},Se={class:"span-container"},$e={__name:"alert",props:{text:{type:String,required:!0},status:{type:String,default:"success"},duration:{type:Number,default:2e3}},setup(t){de(u=>({v7599f3a0:t.duration+"ms"}));const a=t,n=h(!0);return fe(()=>{setTimeout(()=>{n.value=!1},a.duration)}),(u,d)=>(i(),l("div",ke,[o("div",Se,[o("span",{class:V(["alert-container",{success:t.status==="success"},{error:t.status==="error"}])},g(t.text),3)])]))}},qe=_($e,[["__scopeId","data-v-64ef43b9"]]),Ne="/myqueue/images/Exchange.png",Ee={class:"element"},je={style:{display:"flex",gap:"1rem"}},Ce={key:1,class:"loader"},Te={__name:"ElementQueue",props:{item:{type:Object,required:!0}},setup(t,{emit:a}){const n=a,u=h(!1),d=h(!1),y=me("subgroupNumber"),c=m=>{console.log("1"),!d.value&&(d.value=!0,n("excahge",m),setTimeout(()=>{d.value=!1},600))},b=M();return(m,p)=>(i(),l("div",Ee,[o("div",je,[o("span",null,g(t.item.number),1),o("span",null,g(t.item.name),1)]),t.item.status==="–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ"?(i(),l(A,{key:0},[t.item.hideButton?(i(),l("img",{key:0,class:V(["excahgeImage",{rotating:d.value}]),src:Ne,alt:"",onClick:p[0]||(p[0]=I=>c(t.item.uid))},null,2)):x("",!0),u.value?(i(),l("span",Ce)):x("",!0)],64)):t.item.status==="–û—Ç–ø–∏—Å–∞—Ç—å—Å—è"?(i(),l("button",{key:1,onClick:p[1]||(p[1]=I=>n("unsubscribe",t.item.queueId)),class:"unsubscribe"},g(t.item.status),1)):t.item.status==="–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"&&!t.item.hideButton&&(w(b).state.numberSubgroup===w(y)||w(y)==-1)?(i(),l("button",{key:2,onClick:p[2]||(p[2]=I=>n("subscribe",t.item.number)),class:"subscribe"},g(t.item.status),1)):x("",!0)]))}},Ae=_(Te,[["__scopeId","data-v-978373ff"]]),Qe={class:"list"},Le={__name:"ListQueue",props:{queueItems:{type:Array,required:!0}},setup(t,{emit:a}){const n=a;function u(c){n("subscribe",c)}function d(c){n("unsubscribe",c)}function y(c){n("excahge",c)}return(c,b)=>(i(),l("div",Qe,[(i(!0),l(A,null,K(t.queueItems,m=>(i(),$(Ae,{onSubscribe:u,onUnsubscribe:d,onExcahge:y,key:m.number,item:m},null,8,["item"]))),128))]))}},Fe=_(Le,[["__scopeId","data-v-6cd6ff66"]]);typeof process<"u"&&process.platform;var U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Be=new Uint8Array(64),De=new Uint8Array(128);for(let t=0;t<U.length;t++){let a=U.charCodeAt(t);Be[t]=a,De[a]=t}const P="vite-module-runner:import-meta-resolve/v1/";`${JSON.stringify(P)}${JSON.stringify(P)}`;new Proxy({},{get(t,a){throw Error(`[module runner] Dynamic access of "import.meta.env" is not supported. Please, use "import.meta.env.${String(a)}" instead.`)}});const Oe={class:"element"},Ue={class:"elementFooter"},Pe={__name:"ElementNotification",props:{notification:{type:Object,required:!0}},setup(t){const a=t;async function n(){await fetch(`https://localhost:7243/api/exchange/${a.notification.id}`,{method:"PATCH",credentials:"include"})}async function u(){await fetch(`https://localhost:7243/api/exchange/${a.notification.id}`,{method:"DELETE",credentials:"include"})}return(d,y)=>(i(),l("div",Oe,[o("div",null,[he(" –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+g(t.notification?.userName)+" ("+g(t.notification?.number)+"-–æ–µ –º–µ—Å—Ç–æ) —Ö–æ—á–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å—Å—è —Å –≤–∞–º–∏ –º–µ—Å—Ç–∞–º–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç "+g(t.notification?.subjectName)+" ("+g(t.notification?.date)+") ",1),o("div",Ue,[o("span",null,g(t.notification?.createdAt),1),o("button",{class:"buttonConfirm",onClick:n},"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"),o("button",{class:"buttonCancel",onClick:u},"–û—Ç–º–µ–Ω–∏—Ç—å")])])]))}},Ve=_(Pe,[["__scopeId","data-v-c796f847"]]),Me={key:0,class:"conatiner"},Ke={key:1,style:{"text-align":"center"}},Re={__name:"ListNotifications",setup(t){async function a(){try{const c=await fetch("https://localhost:7243/api/exchange",{method:"GET",credentials:"include"});if(c.ok){const b=await c.json();return console.log("data: ",b),Array.isArray(b)?b:[]}else throw new Error(`HTTP error! status: ${c.status}`)}catch(c){return console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:",c),[]}}const{data:n=[],isLoadingNotifications:u,isErrorNotifications:d,refetch:y}=S({queryKey:["notifications"],queryFn:a,refetchOnWindowFocus:!1,retry:!1,staleTime:0,refetchInterval:3e3});return(c,b)=>w(n).length>0?(i(),l("div",Me,[(i(!0),l(A,null,K(w(n),m=>(i(),$(Ve,{notification:m,key:m.id},null,8,["notification"]))),128))])):(i(),l("p",Ke,"–ü—É—Å—Ç–æ"))}},We=_(Re,[["__scopeId","data-v-0abda001"]]),Ge={class:"container"},He={__name:"SettingsProfile",setup(t,{emit:a}){const n=a;async function u(){n("logout"),await fetch("https://localhost:7243/api/users/logout",{credentials:"include"})}return(d,y)=>(i(),l("div",Ge,[o("button",{onClick:u,class:"logoutButton"},"–í—ã–π—Ç–∏")]))}},Je=_(He,[["__scopeId","data-v-fb171c3c"]]),ze={style:{display:"flex","align-items":"start","padding-top":"1.5rem",position:"relative"}},Ye={class:"countNotifications"},Xe={style:{display:"flex","flex-direction":"column",gap:"0.5rem"}},Ze={key:0,style:{display:"flex","justify-content":"center","align-items":"center",flex:"1"}},et={key:1,style:{flex:"1","overflow-y":"auto"}},tt={class:"blockError"},st={__name:"Queue",setup(t){const a=h(""),n=h(""),u=h(null),d=h(-1),y=h(!1),c=h(""),b=h(!1),m=h(!1),p=h(!1),I=h(!1),C=h(""),v=M(),R=Ie();O("isLoading",y),O("subgroupNumber",u),pe((e,s,r)=>{v.state.userId==-1?r(!1):r()});const Q=ge(),W=F({mutationFn:H,onSuccess:()=>{Q.invalidateQueries({queryKey:["queue"]})},onError:e=>{console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏:",e)}}),G=F({mutationFn:J,onSuccess:()=>{Q.invalidateQueries({queryKey:["queue"]})},onError:e=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:",e)}});async function H(e){const s={userId:v.state.userId,dateId:+n.value,numberUser:+e};try{const r=await fetch("https://localhost:7243/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!r.ok){const f=await r.json();C.value=f.message,I.value=!0}}catch(r){I.value=!0,C.value=r.message}}async function J(e){await fetch(`https://localhost:7243/api/queue/${e}`,{method:"DELETE",credentials:"include"})}const z=async()=>{console.log("üì¶ groupId –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:",v.state.groupId);const e=await fetch(`https://localhost:7243/api/subject/subjects/${v.state.groupId}`,{credentials:"include"});if(!e.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø");return e.json()},Y=async()=>{const e=await fetch(`https://localhost:7243/api/subject/schedule/${v.state.groupId}`,{credentials:"include"});if(!e.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø");return await e.json()};async function X(){try{const e=await fetch("https://localhost:7243/api/exchange",{method:"GET",credentials:"include"});if(e.ok){const s=await e.json();return console.log("data: ",s),Array.isArray(s)?s:[]}else throw new Error(`HTTP error! status: ${e.status}`)}catch(e){return console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:",e),[]}}const Z=async()=>{const e=new URLSearchParams({groupId:v.state.groupId,subjectId:+a.value,subgroupNumber:+u.value,dateId:+n.value}).toString(),s=await fetch(`https://localhost:7243/api/queue?${e}`,{credentials:"include"});if(!s.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø");return await s.json()},{data:T=[],isLoadingNotifications:at,isErrorNotifications:nt,refetch:ot}=S({queryKey:["notifications"],queryFn:X,refetchOnWindowFocus:!1,retry:!1,staleTime:0,refetchInterval:3e3}),{data:ee=[],isLoadingGroup:rt,isErrorGroup:it}=S({queryKey:["subject"],queryFn:z,refetchOnWindowFocus:!1,retry:!1,staleTime:3e5}),{data:q=[],isLoadingDates:ut,isErrorDates:ct}=S({queryKey:["dates",a.value],queryFn:Y,enabled:E(()=>a.value!==""),refetchOnWindowFocus:!1,retry:!1,staleTime:3e5}),{data:L=[],isLoadingQueue:lt,isErrorQueue:dt,refetch:ft}=S({queryKey:E(()=>["queue",a.value,n.value,u.value]),queryFn:Z,enabled:E(()=>a.value!==""&&n.value!==""&&u.value!==null),refetchOnWindowFocus:!1,retry:!1,staleTime:0,refetchInterval:1e3}),te=async()=>{const e=await fetch(`https://localhost:7243/api/users/lengthAllStudentsByGroup/${v.state.groupId}`,{credentials:"include"});try{return e.ok?await e.json():0}catch{return 0}},se=async()=>{const e=await fetch(`https://localhost:7243/api/users/lengthAllStudentsBySubgroup/${v.state.groupId}/${u.value}`,{credentials:"include"});try{return e.ok?await e.json():0}catch{return 0}};ve(a,()=>{console.log("1 ",n.value),n.value=""}),ye(async()=>{console.log("2 ",n.value),a.value&&n.value&&(console.log("dates = ",q),console.log("dates.value = ",q?.value),console.log("–ü—Ä–∏–≤–µ—Ç"),u.value=q?.value?.find(e=>e.subjectId===+a?.value&&e.id===+n?.value).forSubgroup,u.value===-1?d.value=await te():d.value=await se())});const ae=E(()=>{if(!d.value||d.value<=0)return[];let s=!!L?.value?.find(f=>f.userId===v.state.userId);console.log("isYou: ",s);const r=new Array(d?.value).fill().map((f,k)=>({number:k+1,name:"",status:"–ó–∞–ø–∏—Å–∞—Ç—å—Å—è",hideButton:s,queueId:null,uid:-1}));for(let f of L?.value||[])r[f.numberUser-1]={...r[f.numberUser-1],name:f.userId===v.state.userId?"–í—ã":f.userName,status:f.userId===v.state.userId?"–û—Ç–ø–∏—Å–∞—Ç—å—Å—è":"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ",hideButton:s,queueId:f.id,uid:f.userId};return r}),ne=e=>{G.mutateAsync(e)},oe=async e=>{W.mutateAsync(e)},re=()=>{const e=new Date,s=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),f=e.getFullYear(),k=String(e.getHours()).padStart(2,"0"),N=String(e.getMinutes()).padStart(2,"0");return`${s}.${r}.${f} ${k}:${N}`},ie=async e=>{const s=re(),r=v.state.userId,f=e,k=n.value;y.value=!0;try{(await fetch("https://localhost:7243/api/exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({CreatedAt:s,FromUserId:r,ToUserId:f,DateId:k})})).ok()&&(c.value="–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–º–µ–Ω –º–µ—Å—Ç–∞–º–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")}catch(N){c.value=N.message}finally{y.value=!1,b.value=!0,setTimeout(()=>b.value=!1,3e3)}},ue=()=>{m.value=!m.value,p.value=!1},ce=()=>{p.value=!p.value,m.value=!1},le=()=>{p.value=!1,R.push("/login/signIn")};return(e,s)=>(i(),l("div",{class:"card",onClick:s[3]||(s[3]=()=>{m.value=!1,p.value=!1})},[o("header",null,[s[4]||(s[4]=o("div",null,[o("h1",null,"–ó–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç"),o("p",null,"–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏ –¥–∞—Ç—É, —á—Ç–æ–±—ã –∑–∞–Ω—è—Ç—å –æ—á–µ—Ä–µ–¥—å")],-1)),o("div",ze,[o("img",{src:_e,class:"notificationsImage",onClick:B(ue,["stop"]),alt:""}),o("img",{src:xe,class:"settingProfile",onClick:B(ce,["stop"])}),o("p",Ye,g(w(T).length<9?w(T).length:"9+"),1),m.value?(i(),$(We,{key:0,notifications:w(T),class:"notifications-list"},null,8,["notifications"])):x("",!0),p.value?(i(),$(Je,{key:1,onLogout:le,class:"settings"})):x("",!0)])]),o("div",Xe,[j(D,{list:w(ee)||[],"id-key":"id","value-key":"name",modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=r=>a.value=r),title:"–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç"},null,8,["list","modelValue"]),j(D,{list:w(q)?.filter(r=>r.subjectId===+a.value)||[],"id-key":"id","value-key":"date",modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=r=>n.value=r),title:"–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"},null,8,["list","modelValue"])]),o("p",null,g(u.value?u.value===-1?"–û–±—â–∞—è":`–ü–æ–¥–≥—Ä—É–ø–ø–∞ ${u.value}`:""),1),a.value==""||n.value==""?(i(),l("div",Ze," –ü—É—Å—Ç–æ ")):(i(),l("div",et,[j(Fe,{onSubscribe:oe,onUnsubscribe:ne,onExcahge:ie,"queue-items":ae.value},null,8,["queue-items"])])),b.value?(i(),$(qe,{key:2,text:"–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",status:"success"})):x("",!0),j(we,{open:I.value},{default:be(()=>[o("div",tt,[o("p",null,g(C.value),1),o("button",{class:"close",style:{"align-self":"flex-end"},onClick:s[2]||(s[2]=r=>I.value=!1)}," –û–∫ ")])]),_:1},8,["open"])]))}},pt=_(st,[["__scopeId","data-v-8e97aa47"]]);export{pt as default};
